<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拉丁方格任务分配系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #3498db;
            --primary-light: #5dade2;
            --secondary: #2ecc71;
            --secondary-dark: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --darker: #1a2530;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --light-gray: #f5f7fa;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* 进度指示器 */
        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 800px;
            margin: 0 auto 40px;
            position: relative;
        }

        .progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            height: 4px;
            background: var(--light-gray);
            width: 100%;
            z-index: 1;
            transform: translateY(-50%);
        }

        .progress-fill {
            position: absolute;
            top: 50%;
            left: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            z-index: 2;
            transform: translateY(-50%);
            transition: width 0.5s ease;
        }

        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--gray);
            z-index: 3;
            position: relative;
            transition: var(--transition);
        }

        .progress-step.active {
            border-color: var(--primary);
            color: var(--primary);
            transform: scale(1.1);
        }

        .progress-step.completed {
            background: var(--secondary);
            border-color: var(--secondary);
            color: white;
        }

        .step-label {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .step-label.active {
            color: var(--primary);
            font-weight: bold;
        }

        /* 卡片样式 */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 40px;
            margin-bottom: 30px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 步骤0 - 开始界面 */
        .welcome-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .welcome-header h1 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .welcome-header p {
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.1rem;
        }

        .system-info {
            display: flex;
            gap: 20px;
            margin: 40px 0;
        }

        .info-card {
            flex: 1;
            background: var(--light-gray);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            transition: var(--transition);
        }

        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .info-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .info-card h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .info-card p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        /* 用户输入表单 */
        .user-input-form {
            max-width: 500px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
        }

        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
        }

        input[type="text"]:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            text-align: center;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 15px rgba(46, 204, 113, 0.4);
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* 任务卡片 */
        .task-card {
            max-width: 800px;
            margin: 0 auto;
        }

        .task-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .task-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .task-type-badge {
            padding: 6px 18px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            margin-left: 15px;
        }

        .eval-badge {
            background: rgba(46, 204, 113, 0.15);
            color: #27ae60;
        }

        .create-badge {
            background: rgba(231, 76, 60, 0.15);
            color: #c0392b;
        }

        .task-content {
            margin: 25px 0 35px;
        }

        .task-content h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .task-description {
            margin-bottom: 30px;
            line-height: 1.8;
            background: var(--light-gray);
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            font-size: 1.1rem;
        }

        /* 优化输入框 - 固定较大的输入框高度 */
        .answer-textarea {
            width: 100%;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            min-height: 300px;
            height: 300px;
            resize: none;
            transition: var(--transition);
            line-height: 1.7;
        }

        .answer-textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .input-hint {
            display: block;
            text-align: right;
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .character-counter {
            position: absolute;
            right: 15px;
            bottom: 40px;
            font-size: 0.85rem;
            color: var(--gray);
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* 评分部分 */
        .rating-section {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
            border: 1px solid #eee;
        }

        .rating-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .rating-title h3 {
            margin-bottom: 10px;
        }

        .rating-title p {
            color: var(--gray);
        }

        /* 星级说明 */
        .rating-scale-info {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 8px;
            font-weight: 600;
            color: var(--warning);
        }

        .rating-criteria {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .rating-item {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .rating-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .rating-item h4 {
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rating-item i {
            color: var(--warning);
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .star {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .star:hover, .star.active {
            color: var(--warning);
            transform: scale(1.1);
        }

        /* 完成界面 */
        .completion-container {
            text-align: center;
            padding: 50px 0;
        }

        .completion-icon {
            font-size: 5rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .completion-message {
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .completion-message h2 {
            margin-bottom: 15px;
            color: var(--dark);
        }

        .completion-message p {
            color: var(--gray);
            font-size: 1.1rem;
            line-height: 1.8;
        }

        /* 数据收集提示 */
        .data-collection-message {
            background-color: rgba(52, 152, 219, 0.1);
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .data-collection-message i {
            color: var(--primary);
            margin-right: 8px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .system-info {
                flex-direction: column;
            }

            .progress-step {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .step-label {
                font-size: 0.75rem;
            }

            .card {
                padding: 25px;
            }

            .rating-criteria {
                grid-template-columns: 1fr;
            }

            .task-header {
                flex-direction: column;
                text-align: center;
            }

            .task-type-badge {
                margin: 10px 0 0 0;
            }

            .answer-textarea {
                min-height: 300px;
                font-size: 1.05rem;
            }
        }

        @media (min-width: 1200px) {
            .answer-textarea {
                min-height: 300px;
            }
        }

        /* 数据查看面板 */
        .data-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            padding: 15px;
            width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .data-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .data-panel-header h3 {
            color: var(--dark);
        }

        .data-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
            z-index: 1001;
        }

        .data-item {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            background: var(--light-gray);
        }

        .data-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .data-item-content {
            font-size: 0.9rem;
            color: var(--darker);
            line-height: 1.5;
        }

        .rating-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85rem;
        }

        .rating-value {
            font-weight: 600;
            color: var(--warning);
        }

        /* 用户完整数据项 */
        .user-session-data {
            background: #f0f8ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }

        .session-header {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-data {
            margin: 15px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .task-title {
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .task-title i {
            margin-right: 8px;
            color: var(--primary);
        }

        .task-answer {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            font-size: 0.9rem;
            max-height: 150px;
            overflow-y: auto;
        }

        .task-timing {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 8px;
        }

        /* 确认对话框 */
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .confirmation-dialog.active {
            opacity: 1;
            visibility: visible;
        }

        .dialog-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-hover);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .confirmation-dialog.active .dialog-content {
            transform: translateY(0);
        }

        .dialog-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .dialog-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .dialog-buttons .btn {
            flex: 1;
        }
        .go-ai-container {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .go-ai-btn {
            background: linear-gradient(135deg, #10a37f, #0d8e6f);
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .go-ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #0d8e6f, #0b7a5f);
        }

        .go-ai-btn i {
            font-size: 1.1rem;
        }

        @media (max-width: 768px) {
            .go-ai-container {
                position: static;
                margin-top: 15px;
                display: flex;
                justify-content: center;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 进度指示器 -->
        <div class="progress-container">
            <div class="progress-bar"></div>
            <div class="progress-fill"></div>

            <div class="progress-step completed" id="step0-indicator">
                <span>0</span>
                <span class="step-label">开始</span>
            </div>

            <div class="progress-step" id="step1-indicator">
                <span>1</span>
                <span class="step-label">任务1</span>
            </div>

            <div class="progress-step" id="step2-indicator">
                <span>2</span>
                <span class="step-label">任务2</span>
            </div>

            <div class="progress-step" id="step3-indicator">
                <span>3</span>
                <span class="step-label">完成</span>
            </div>
        </div>

        <!-- 步骤0：开始界面 -->
        <div class="card step active" id="step0">
            <div class="welcome-header">
                <h1><i class="fas fa-tasks"></i> 拉丁方格任务分配系统</h1>
                <p>基于拉丁方格算法的随机任务分配，确保公平性和平衡性</p>
            </div>

            <div class="system-info">
                <div class="info-card">
                    <i class="fas fa-random"></i>
                    <h3>拉丁方格分配</h3>
                    <p>使用拉丁方格算法为每个用户分配一个评估类任务和一个创造类任务</p>
                </div>

                <div class="info-card">
                    <i class="fas fa-star"></i>
                    <h3>AI评分系统</h3>
                    <p>每个任务提交后，对AI提供的答案进行四个维度的满意度评分</p>
                </div>

                <div class="info-card">
                    <i class="fas fa-lock"></i>
                    <h3>隐私保护</h3>
                    <p>用户只能看到自己分配到的任务内容，无法访问其他用户的任务信息</p>
                </div>
            </div>

            <div class="user-input-form">
                <div class="form-group">
                    <label for="userId"><i class="fas fa-user"></i> 请输入您的用户ID：</label>
                    <input type="text" id="userId" placeholder="输入1-100之间的数字" required>
                </div>

                <div class="data-collection-message">
                    <i class="fas fa-info-circle"></i> 您提交的所有答案和评分将被安全存储，仅用于研究目的
                </div>

                <button class="btn btn-block" id="startBtn">
                    <i class="fas fa-play"></i> 开始任务
                </button>
            </div>
        </div>

        <!-- 步骤1：任务1界面 -->
        <div class="card step" id="step1">
            <div class="go-ai-container">
                <a href="https://chat.openai.com" target="_blank" class="go-ai-btn">
                    <i class="fas fa-robot"></i> go AI
                </a>
            </div>
            <div class="task-card">
                <div class="task-header">
                    <div class="task-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div>
                        <h2 id="task1-title">任务1: 评估-生活</h2>
                        <p>用户ID: <span id="task1-userId">-</span></p>
                    </div>
                </div>

                <div class="task-content">
                    <h3><i class="fas fa-question-circle"></i> 任务描述</h3>
                    <div class="task-description" id="task1-description">
                        <p><strong>选择哪一款国产品牌的洗衣液性价比高？</strong></p>
                        <p>请比较至少三个国产品牌洗衣液的以下方面：价格、清洁效果、环保性、香味持久度。基于您的比较，推荐一款性价比最高的产品并说明理由。</p>
                    </div>

                    <div class="form-group">
                        <label for="task1-answer"><i class="fas fa-edit"></i> 您的分析与推荐：</label>
                        <textarea class="answer-textarea" id="task1-answer" placeholder="请在此输入您的分析..."></textarea>
                        <div class="character-counter" id="task1-counter">0/1000</div>
                    </div>

                    <div class="data-collection-message">
                        <i class="fas fa-database"></i> 您的回答将被安全存储用于研究分析
                    </div>
                </div>

                <button class="btn btn-block" id="submitTask1Btn">
                    <i class="fas fa-paper-plane"></i> 提交任务
                </button>
            </div>
        </div>

        <!-- 步骤1.5：任务1评分界面 -->
        <div class="card step" id="step1-rating">
            <div class="rating-section">
                <div class="rating-title">
                    <h3><i class="fas fa-star"></i> 请为AI提供的答案评分</h3>
                    <p>您的反馈将帮助我们改进AI服务质量</p>
                    <div class="rating-scale-info">
                        <i class="fas fa-info-circle"></i>
                        评分说明：1星（非常不同意）→ 5星（非常同意）
                    </div>
                </div>

                <div class="rating-criteria">
                    <div class="rating-item">
                        <h4><i class="fas fa-comments"></i> AI能够理解我的问题</h4>
                        <p>AI是否准确理解了您的问题意图？</p>
                        <div class="stars" data-category="understanding">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-search"></i> AI找到的信息相关性高</h4>
                        <p>AI提供的信息是否与您的问题高度相关？</p>
                        <div class="stars" data-category="relevance">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-graduation-cap"></i> AI提供的回答质量高</h4>
                        <p>AI的回答是否全面、准确、有深度？</p>
                        <div class="stars" data-category="quality">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-bolt"></i> AI响应及时</h4>
                        <p>AI是否在合理时间内提供了回答？</p>
                        <div class="stars" data-category="responsiveness">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>
                </div>

                <div class="data-collection-message">
                    <i class="fas fa-chart-bar"></i> 您的评分数据将用于改善AI服务质量
                </div>

                <button class="btn btn-block" id="submitRating1Btn">
                    <i class="fas fa-check-circle"></i> 提交评分并继续
                </button>
            </div>
        </div>

        <!-- 步骤2：任务2界面 -->
        <div class="card step" id="step2">
            <div class="go-ai-container">
                <a href="https://chat.openai.com" target="_blank" class="go-ai-btn">
                    <i class="fas fa-robot"></i> go AI
                </a>
            </div>
            <div class="task-card">
                <div class="task-header">
                    <div class="task-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div>
                        <h2 id="task2-title">任务2: 创造-学习</h2>
                        <p>用户ID: <span id="task2-userId">-</span></p>
                    </div>
                </div>

                <div class="task-content">
                    <h3><i class="fas fa-question-circle"></i> 任务描述</h3>
                    <div class="task-description" id="task2-description">
                        <p><strong>《中国美术史》小组报告选题</strong></p>
                        <p>假设这学期你选择了《中国美术史》这门课程，请提出一个可行的小组报告选题，并列出简要框架。选题应具有研究价值且能在20分钟展示时间内充分呈现。</p>
                    </div>

                    <div class="form-group">
                        <label for="task2-answer"><i class="fas fa-edit"></i> 您的选题与框架：</label>
                        <textarea class="answer-textarea" id="task2-answer" placeholder="请在此输入您的选题和框架..."></textarea>
                        <div class="character-counter" id="task2-counter">0/1000</div>
                    </div>

                    <div class="data-collection-message">
                        <i class="fas fa-database"></i> 您的回答将被安全存储用于研究分析
                    </div>
                </div>

                <button class="btn btn-block" id="submitTask2Btn">
                    <i class="fas fa-paper-plane"></i> 提交任务
                </button>
            </div>
        </div>

        <!-- 步骤2.5：任务2评分界面 -->
        <div class="card step" id="step2-rating">
            <div class="rating-section">
                <div class="rating-title">
                    <h3><i class="fas fa-star"></i> 请为AI提供的答案评分</h3>
                    <p>您的反馈将帮助我们改进AI服务质量</p>
                    <div class="rating-scale-info">
                        <i class="fas fa-info-circle"></i>
                        评分说明：1星（非常不同意）→ 5星（非常同意）
                    </div>
                </div>

                <div class="rating-criteria">
                    <div class="rating-item">
                        <h4><i class="fas fa-comments"></i> AI能够理解我的问题</h4>
                        <p>AI是否准确理解了您的问题意图？</p>
                        <div class="stars" data-category="understanding">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-search"></i> AI找到的信息相关性高</h4>
                        <p>AI提供的信息是否与您的问题高度相关？</p>
                        <div class="stars" data-category="relevance">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-graduation-cap"></i> AI提供的回答质量高</h4>
                        <p>AI的回答是否全面、准确、有深度？</p>
                        <div class="stars" data-category="quality">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>

                    <div class="rating-item">
                        <h4><i class="fas fa-bolt"></i> AI响应及时</h4>
                        <p>AI是否在合理时间内提供了回答？</p>
                        <div class="stars" data-category="responsiveness">
                            <div class="star" data-rating="1">★</div>
                            <div class="star" data-rating="2">★</div>
                            <div class="star" data-rating="3">★</div>
                            <div class="star" data-rating="4">★</div>
                            <div class="star" data-rating="5">★</div>
                        </div>
                    </div>
                </div>

                <div class="data-collection-message">
                    <i class="fas fa-chart-bar"></i> 您的评分数据将用于改善AI服务质量
                </div>

                <button class="btn btn-block" id="submitRating2Btn">
                    <i class="fas fa-check-circle"></i> 提交评分并继续
                </button>
            </div>
        </div>

        <!-- 步骤3：完成界面 -->
        <div class="card step" id="step3">
            <div class="completion-container">
                <div class="completion-icon">
                    <i class="fas fa-check-circle"></i>
                </div>

                <div class="completion-message">
                    <h2>任务完成！</h2>
                    <p>您已成功完成所有分配任务并提交了评分，感谢您的参与！系统将在5秒后自动返回初始界面，或者您可以点击下方按钮立即返回。</p>
                    <p><strong>您的数据已安全存储：</strong>用户ID: <span id="completed-userId"></span></p>
                </div>

                <button class="btn btn-secondary" id="returnBtn">
                    <i class="fas fa-home"></i> 立即返回初始界面
                </button>
            </div>
        </div>
    </div>

    <!-- 数据收集面板 -->
    <div class="data-toggle-btn" id="dataToggleBtn">
        <i class="fas fa-database"></i>
    </div>

    <div class="data-panel" id="dataPanel">
        <div class="data-panel-header">
            <h3><i class="fas fa-table"></i> 收集的数据</h3>
            <button class="btn" id="downloadBtn">
                <i class="fas fa-download"></i> 导出数据
            </button>
        </div>
        <div id="dataContent"></div>
    </div>

    <!-- 确认对话框 -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content">
            <div class="dialog-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <h3>确认提交任务？</h3>
            <p>您确定要提交当前任务吗？提交后将无法修改答案。</p>
            <div class="dialog-buttons">
                <button class="btn" id="dialogCancelBtn">取消</button>
                <button class="btn btn-secondary" id="dialogConfirmBtn">确认提交</button>
            </div>
        </div>
    </div>

    <script>
        // 当前步骤状态管理
        let currentStep = 0;
        const steps = ['step0', 'step1', 'step1-rating', 'step2', 'step2-rating', 'step3'];
        const progressIndicators = ['step0-indicator', 'step1-indicator', 'step2-indicator', 'step3-indicator'];
        const userIdInput = document.getElementById('userId');
        const task1UserId = document.getElementById('task1-userId');
        const task2UserId = document.getElementById('task2-userId');
        const completedUserId = document.getElementById('completed-userId');
        const confirmationDialog = document.getElementById('confirmationDialog');
        const dialogCancelBtn = document.getElementById('dialogCancelBtn');
        const dialogConfirmBtn = document.getElementById('dialogConfirmBtn');

        // 自动返回定时器
        let autoReturnTimer = null;

        // 数据存储
        let collectedData = [];
        let userSessions = []; // 存储完整用户会话数据
        let currentTaskToSubmit = null; // 记录当前要提交的任务

        // 记录上一个用户ID（用于自动生成下一个ID）
        let lastUserId = 0;

        // 计时器变量
        let task1StartTime, task1EndTime, task1RatingStartTime, task1RatingEndTime;
        let task2StartTime, task2EndTime, task2RatingStartTime, task2RatingEndTime;

        // 评分数据
        let task1Ratings = {
            understanding: 0,
            relevance: 0,
            quality: 0,
            responsiveness: 0
        };

        let task2Ratings = {
            understanding: 0,
            relevance: 0,
            quality: 0,
            responsiveness: 0
        };

        // 任务定义
        const tasks = {
            eval: [
                {
                    id: "eval-learn",
                    title: "评估-学习",
                    description: `<p><strong>Bing和百度相比哪个更好用？</strong></p>
                                  <p>请从搜索结果质量、广告数量、用户体验、特色功能等方面进行比较分析，并给出您的选择建议。</p>`,
                    type: "评估"
                },
                {
                    id: "eval-life",
                    title: "评估-生活",
                    description: `<p><strong>选择哪一款国产品牌的洗衣液性价比高？</strong></p>
                                  <p>请比较至少三个国产品牌洗衣液的以下方面：价格、清洁效果、环保性、香味持久度。基于您的比较，推荐一款性价比最高的产品并说明理由。</p>`,
                    type: "评估"
                },
                {
                    id: "eval-work",
                    title: "评估-工作",
                    description: `<p><strong>请列举2个你认为最有效的绩效管理指标，并说明理由。</strong></p>
                                  <p>这些指标应适用于大多数行业，并具有可量化、公平性强的特点。</p>`,
                    type: "评估"
                }
            ],
            create: [
                {
                    id: "create-learn",
                    title: "创造-学习",
                    description: `<p><strong>《中国美术史》小组报告选题</strong></p>
                                  <p>假设这学期你选择了《中国美术史》这门课程，请提出一个可行的小组报告选题，并列出简要框架。选题应具有研究价值且能在20分钟展示时间内充分呈现。</p>`,
                    type: "创造"
                },
                {
                    id: "create-life",
                    title: "创造-生活",
                    description: `<p><strong>黄鹤楼一日出行计划</strong></p>
                                  <p>假如你周末想前往黄鹤楼及周边游玩，请提供一个一日出行计划。包括时间安排、交通方式、景点游览顺序、餐饮建议等。</p>`,
                    type: "创造"
                },
                {
                    id: "create-work",
                    title: "创造-工作",
                    description: `<p><strong>母亲节购物推送</strong></p>
                                  <p>请以母亲节为主题，完成一篇150字以内吸引用户的购物推送。要求包含情感元素、产品推荐和促销信息，能引发用户共鸣并促进消费。</p>`,
                    type: "创造"
                }
            ]
        };

        // 用户分配的任务
        let userTasks = {
            task1: null,
            task2: null
        };

        // 拉丁方格分配算法
        function latinSquareAssignment(userId) {
            // 生成随机的评估任务索引 (0, 1, 2)
            const evalIndex = Math.floor(Math.random() * 3);

            // 生成随机的创造任务索引 (0, 1, 2)
            let createIndex;
            do {
                createIndex = Math.floor(Math.random() * 3);
            } while (createIndex === evalIndex); // 确保评估和创造任务不同

            return {
                task1: tasks.eval[evalIndex],
                task2: tasks.create[createIndex]
            };
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 开始按钮
            document.getElementById('startBtn').addEventListener('click', function() {
                // 清除任何可能存在的自动返回定时器
                if (autoReturnTimer) {
                    clearTimeout(autoReturnTimer);
                    autoReturnTimer = null;
                }

                const userId = userIdInput.value;
                if (!userId || userId < 1 || userId > 100) {
                    alert('请输入1-100之间的有效用户ID');
                    return;
                }

                // 记录当前用户ID
                lastUserId = parseInt(userId);

                // 使用拉丁方格算法分配任务
                userTasks = latinSquareAssignment(userId);

                // 设置用户ID显示
                task1UserId.textContent = userId;
                task2UserId.textContent = userId;
                completedUserId.textContent = userId;

                // 设置任务1内容
                document.getElementById('task1-title').textContent = `任务1: ${userTasks.task1.title}`;
                document.getElementById('task1-description').innerHTML = userTasks.task1.description;

                // 设置任务2内容
                document.getElementById('task2-title').textContent = `任务2: ${userTasks.task2.title}`;
                document.getElementById('task2-description').innerHTML = userTasks.task2.description;

                // 记录任务1开始时间
                task1StartTime = new Date();

                navigateToStep(1);
            });

            // 任务1提交
            document.getElementById('submitTask1Btn').addEventListener('click', function() {
                const answer = document.getElementById('task1-answer').value;
                if (!answer.trim()) {
                    alert('请填写任务答案后再提交！');
                    return;
                }

                // 显示确认对话框
                currentTaskToSubmit = 'task1';
                showConfirmationDialog();
            });

            // 任务1评分提交
            document.getElementById('submitRating1Btn').addEventListener('click', function() {
                if (!validateRating(task1Ratings)) {
                    alert('请完成所有评分项后再提交！');
                    return;
                }

                // 记录任务1评分结束时间
                task1RatingEndTime = new Date();

                // 保存任务1评分
                saveTaskRating(userIdInput.value, userTasks.task1, task1Ratings);

                // 记录任务2开始时间
                task2StartTime = new Date();

                navigateToStep(3);
            });

            // 任务2提交
            document.getElementById('submitTask2Btn').addEventListener('click', function() {
                const answer = document.getElementById('task2-answer').value;
                if (!answer.trim()) {
                    alert('请填写任务答案后再提交！');
                    return;
                }

                // 显示确认对话框
                currentTaskToSubmit = 'task2';
                showConfirmationDialog();
            });

            // 任务2评分提交
            document.getElementById('submitRating2Btn').addEventListener('click', function() {
                if (!validateRating(task2Ratings)) {
                    alert('请完成所有评分项后再提交！');
                    return;
                }

                // 记录任务2评分结束时间
                task2RatingEndTime = new Date();

                // 保存任务2评分
                saveTaskRating(userIdInput.value, userTasks.task2, task2Ratings);

                // 创建并保存完整用户会话数据
                saveUserSession(userIdInput.value);

                navigateToStep(5);
            });

            // 返回按钮
            document.getElementById('returnBtn').addEventListener('click', function() {
                resetSystem();
            });

            // 初始化星级评分
            initRating();

            // 数据面板切换
            document.getElementById('dataToggleBtn').addEventListener('click', function() {
                const dataPanel = document.getElementById('dataPanel');
                dataPanel.style.display = dataPanel.style.display === 'block' ? 'none' : 'block';
                renderCollectedData();
            });

            // 数据导出
            document.getElementById('downloadBtn').addEventListener('click', downloadData);

            // 确认对话框按钮
            dialogCancelBtn.addEventListener('click', hideConfirmationDialog);
            dialogConfirmBtn.addEventListener('click', handleTaskSubmission);

            // 初始化字符计数器
            initCharacterCounters();
        });

        // 显示确认对话框
        function showConfirmationDialog() {
            confirmationDialog.classList.add('active');
        }

        // 隐藏确认对话框
        function hideConfirmationDialog() {
            confirmationDialog.classList.remove('active');
        }

        // 处理任务提交确认
        function handleTaskSubmission() {
            hideConfirmationDialog();

            const userId = userIdInput.value;
            let answer, task;

            if (currentTaskToSubmit === 'task1') {
                answer = document.getElementById('task1-answer').value;
                task = userTasks.task1;

                // 记录任务1结束时间
                task1EndTime = new Date();

                // 保存任务1答案
                saveTaskAnswer(userId, task, answer);

                // 记录任务1评分开始时间
                task1RatingStartTime = new Date();

                navigateToStep(2);
            } else if (currentTaskToSubmit === 'task2') {
                answer = document.getElementById('task2-answer').value;
                task = userTasks.task2;

                // 记录任务2结束时间
                task2EndTime = new Date();

                // 保存任务2答案
                saveTaskAnswer(userId, task, answer);

                // 记录任务2评分开始时间
                task2RatingStartTime = new Date();

                navigateToStep(4);
            }
        }

        // 初始化字符计数器
        function initCharacterCounters() {
            const task1Answer = document.getElementById('task1-answer');
            const task1Counter = document.getElementById('task1-counter');

            const task2Answer = document.getElementById('task2-answer');
            const task2Counter = document.getElementById('task2-counter');

            // 任务1计数器
            task1Answer.addEventListener('input', function() {
                const length = this.value.length;
                task1Counter.textContent = `${length}/1000`;

                // 如果超过最大长度，添加警告样式
                if (length > 1000) {
                    task1Counter.style.color = 'var(--danger)';
                    task1Counter.style.fontWeight = 'bold';
                } else {
                    task1Counter.style.color = 'var(--gray)';
                    task1Counter.style.fontWeight = 'normal';
                }
            });

            // 任务2计数器
            task2Answer.addEventListener('input', function() {
                const length = this.value.length;
                task2Counter.textContent = `${length}/1000`;

                // 如果超过最大长度，添加警告样式
                if (length > 1000) {
                    task2Counter.style.color = 'var(--danger)';
                    task2Counter.style.fontWeight = 'bold';
                } else {
                    task2Counter.style.color = 'var(--gray)';
                    task2Counter.style.fontWeight = 'normal';
                }
            });
        }

        // 初始化评分系统
        function initRating() {
            // 绑定所有星星的点击事件
            document.querySelectorAll('.stars').forEach(starsContainer => {
                const stars = starsContainer.querySelectorAll('.star');
                const category = starsContainer.getAttribute('data-category');

                stars.forEach((star, starIndex) => {
                    star.addEventListener('click', function() {
                        // 重置当前容器中的所有星星
                        stars.forEach(s => s.classList.remove('active'));

                        // 激活选中的星星
                        for (let i = 0; i <= starIndex; i++) {
                            stars[i].classList.add('active');
                        }

                        // 确定当前评分属于哪个任务
                        let ratingsObj;
                        if (starsContainer.closest('#step1-rating')) {
                            ratingsObj = task1Ratings;
                        } else if (starsContainer.closest('#step2-rating')) {
                            ratingsObj = task2Ratings;
                        } else {
                            return;
                        }

                        // 更新评分数据
                        ratingsObj[category] = starIndex + 1;
                    });
                });
            });
        }

        // 保存任务答案
        function saveTaskAnswer(userId, task, answer) {
            const timestamp = new Date().toISOString();

            collectedData.push({
                type: 'answer',
                userId: userId,
                taskId: task.id,
                taskTitle: task.title,
                taskType: task.type,
                answer: answer,
                timestamp: timestamp
            });

            console.log('任务答案已保存:', collectedData[collectedData.length - 1]);
        }

        // 保存任务评分
        function saveTaskRating(userId, task, ratings) {
            const timestamp = new Date().toISOString();

            collectedData.push({
                type: 'rating',
                userId: userId,
                taskId: task.id,
                taskTitle: task.title,
                taskType: task.type,
                ratings: {...ratings},
                timestamp: timestamp
            });

            console.log('任务评分已保存:', collectedData[collectedData.length - 1]);
        }

        // 保存完整用户会话数据
        function saveUserSession(userId) {
            // 计算任务用时（秒）
            const task1AnswerTime = Math.round((task1EndTime - task1StartTime) / 1000);
            const task1RatingTime = Math.round((task1RatingEndTime - task1RatingStartTime) / 1000);
            const task2AnswerTime = Math.round((task2EndTime - task2StartTime) / 1000);
            const task2RatingTime = Math.round((task2RatingEndTime - task2RatingStartTime) / 1000);

            const sessionData = {
                userId: userId,
                task1: {
                    taskId: userTasks.task1.id,
                    title: userTasks.task1.title,
                    type: userTasks.task1.type,
                    description: userTasks.task1.description,
                    answer: document.getElementById('task1-answer').value,
                    ratings: {...task1Ratings},
                    answerTime: task1AnswerTime,
                    ratingTime: task1RatingTime
                },
                task2: {
                    taskId: userTasks.task2.id,
                    title: userTasks.task2.title,
                    type: userTasks.task2.type,
                    description: userTasks.task2.description,
                    answer: document.getElementById('task2-answer').value,
                    ratings: {...task2Ratings},
                    answerTime: task2AnswerTime,
                    ratingTime: task2RatingTime
                },
                completedAt: new Date().toISOString()
            };
            // 添加发送数据到Python后端的代码
            sendDataToPython(sessionData);
            userSessions.push(sessionData);
            console.log('用户会话数据已保存:', sessionData);
        }
        // 新增发送数据到Python后端
        function sendDataToPython(data) {
            // 使用WebSocket发送数据
            const ws = new WebSocket('ws://localhost:8765');

            ws.onopen = () => {
                console.log('WebSocket连接已建立');
                ws.send(JSON.stringify(data));
                ws.close();
            };

            ws.onerror = (error) => {
                console.error('WebSocket错误:', error);
            };

            ws.onclose = () => {
                console.log('WebSocket连接已关闭');
            };
        }
        // 渲染收集的数据
        function renderCollectedData() {
            const dataContent = document.getElementById('dataContent');
            dataContent.innerHTML = '';

            if (userSessions.length === 0) {
                dataContent.innerHTML = '<p class="data-item">暂无用户会话数据</p>';
                return;
            }

            // 以用户会话为单位显示数据
            userSessions.forEach((session, index) => {
                const sessionElement = document.createElement('div');
                sessionElement.className = 'user-session-data';

                sessionElement.innerHTML = `
                    <div class="session-header">
                        <span><i class="fas fa-user"></i> 用户ID: ${session.userId}</span>
                        <span>${new Date(session.completedAt).toLocaleString()}</span>
                    </div>

                    <div class="task-data">
                        <div class="task-title">
                            <i class="fas fa-tasks"></i> 任务1: ${session.task1.title} (${session.task1.type})
                        </div>
                        <div class="task-description">${session.task1.description}</div>
                        <div class="task-answer">${session.task1.answer}</div>
                        <div class="rating-summary">
                            <span>理解: <span class="rating-value">${session.task1.ratings.understanding}</span>/5</span>
                            <span>相关: <span class="rating-value">${session.task1.ratings.relevance}</span>/5</span>
                            <span>质量: <span class="rating-value">${session.task1.ratings.quality}</span>/5</span>
                            <span>响应: <span class="rating-value">${session.task1.ratings.responsiveness}</span>/5</span>
                        </div>
                        <div class="task-timing">
                            <span>答题用时: ${session.task1.answerTime}秒</span>
                            <span>评价用时: ${session.task1.ratingTime}秒</span>
                        </div>
                    </div>

                    <div class="task-data">
                        <div class="task-title">
                            <i class="fas fa-tasks"></i> 任务2: ${session.task2.title} (${session.task2.type})
                        </div>
                        <div class="task-description">${session.task2.description}</div>
                        <div class="task-answer">${session.task2.answer}</div>
                        <div class="rating-summary">
                            <span>理解: <span class="rating-value">${session.task2.ratings.understanding}</span>/5</span>
                            <span>相关: <span class="rating-value">${session.task2.ratings.relevance}</span>/5</span>
                            <span>质量: <span class="rating-value">${session.task2.ratings.quality}</span>/5</span>
                            <span>响应: <span class="rating-value">${session.task2.ratings.responsiveness}</span>/5</span>
                        </div>
                        <div class="task-timing">
                            <span>答题用时: ${session.task2.answerTime}秒</span>
                            <span>评价用时: ${session.task2.ratingTime}秒</span>
                        </div>
                    </div>
                `;

                dataContent.appendChild(sessionElement);
            });
        }

        // 导出数据
        function downloadData() {
            if (userSessions.length === 0) {
                alert('没有用户会话数据可导出');
                return;
            }

            const dataStr = JSON.stringify(userSessions, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `user-sessions-${new Date().toISOString().slice(0,10)}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 导航到指定步骤
        function navigateToStep(stepIndex) {
            // 隐藏所有步骤
            steps.forEach(step => {
                document.getElementById(step).classList.remove('active');
            });

            // 显示当前步骤
            document.getElementById(steps[stepIndex]).classList.add('active');

            // 更新进度指示器
            updateProgressIndicator(stepIndex);

            // 更新进度条
            updateProgressBar(stepIndex);

            // 更新当前步骤
            currentStep = stepIndex;

            // 如果是完成界面，设置自动返回
            if (stepIndex === 5) {
                // 清除之前的定时器
                if (autoReturnTimer) {
                    clearTimeout(autoReturnTimer);
                }

                // 设置新的定时器
                autoReturnTimer = setTimeout(resetSystem, 5000);
            }
        }

        // 更新进度指示器
        function updateProgressIndicator(stepIndex) {
            // 重置所有指示器
            progressIndicators.forEach(indicator => {
                document.getElementById(indicator).classList.remove('active', 'completed');
            });

            // 根据当前步骤更新指示器
            if (stepIndex >= 1) {
                document.getElementById('step1-indicator').classList.add('completed');
            }

            if (stepIndex >= 3) {
                document.getElementById('step2-indicator').classList.add('completed');
            }

            if (stepIndex >= 5) {
                document.getElementById('step3-indicator').classList.add('completed');
            }

            // 设置当前活动指示器
            if (stepIndex < 1) {
                document.getElementById('step0-indicator').classList.add('active');
            } else if (stepIndex < 3) {
                document.getElementById('step1-indicator').classList.add('active');
            } else if (stepIndex < 5) {
                document.getElementById('step2-indicator').classList.add('active');
            } else {
                document.getElementById('step3-indicator').classList.add('active');
            }
        }

        // 更新进度条
        function updateProgressBar(stepIndex) {
            const progressFill = document.querySelector('.progress-fill');
            let progress = 0;

            if (stepIndex >= 1) progress = 33;
            if (stepIndex >= 3) progress = 66;
            if (stepIndex >= 5) progress = 100;

            progressFill.style.width = `${progress}%`;
        }

        // 验证评分是否完成
        function validateRating(ratings) {
            for (const key in ratings) {
                if (ratings[key] === 0) {
                    return false;
                }
            }
            return true;
        }

        // 重置系统
        function resetSystem() {
            // 清除自动返回定时器
            if (autoReturnTimer) {
                clearTimeout(autoReturnTimer);
                autoReturnTimer = null;
            }

            // 重置表单
            document.getElementById('userId').value = '';
            document.getElementById('task1-answer').value = '';
            document.getElementById('task2-answer').value = '';

            // 重置字符计数器
            document.getElementById('task1-counter').textContent = '0/1000';
            document.getElementById('task2-counter').textContent = '0/1000';

            // 重置评分
            task1Ratings = {
                understanding: 0,
                relevance: 0,
                quality: 0,
                responsiveness: 0
            };

            task2Ratings = {
                understanding: 0,
                relevance: 0,
                quality: 0,
                responsiveness: 0
            };

            // 重置星星
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
            });

            // 重置任务分配
            userTasks = {
                task1: null,
                task2: null
            };

            // 重置进度
            updateProgressBar(0);
            updateProgressIndicator(0);

            // 自动生成下一个用户ID (1-100循环)
            const nextUserId = lastUserId === 0 ? 1 : (lastUserId % 100) + 1;
            document.getElementById('userId').value = nextUserId;

            // 回到初始界面
            navigateToStep(0);
        }
    </script>
</body>
</html>